apiVersion: v1
kind: ConfigMap
metadata:
  name: taginfo-config
data:
  taginfo-config.json: |
    {
      "instance": {
        "url": "http://localhost:8004",
        "name": "OpenStreetMap Taginfo",
        "description": "Local Taginfo instance.",
        "about": "<p>This site is maintained locally.</p>",
        "icon": "/img/logo/test.png",
        "contact": "local",
        "area": "World",
        "access_control_allow_origin": "*",
        "sections": ["taginfo"]
      },
      "project": {
        "url": "https://www.openstreetmap.org/",
        "name": "OpenStreetMap",
        "attribution_url": "https://www.openstreetmap.org/copyright",
        "attribution_text": "Data (c) OSM contributors (ODbL)"
      },
      "geodistribution": {
        "left": -180,
        "bottom": -90,
        "right": 180,
        "top": 90,
        "width": 360,
        "height": 180,
        "scale_image": 2,
        "scale_compare_image": 1,
        "background_image": "/img/mapbg/world.png",
        "image_attribution": ""
      },
      "paths": {
        "data_dir": "../../data",
        "download_dir": "../../download",
        "bin_dir": "../../../taginfo-tools/build/src"
      },
      "xapi": {
        "max_results": 1000,
        "url_prefix": "https://overpass-api.de/api/xapi_meta?"
      },
      "turbo": {
        "max_auto": 1000,
        "url_prefix": "https://overpass-turbo.eu/?",
        "wizard_area": "global"
      },
      "level0": {
        "max_results": 50,
        "overpass_url_prefix": "https://overpass-api.de/api/interpreter?",
        "level0_url_prefix": "https://level0.osmz.ru/?"
      },
      "opensearch": {
        "shortname": "Taginfo Local",
        "contact": "local",
        "description": "Find metadata about OpenStreetMap tags",
        "tags": "osm openstreetmap tag tags taginfo"
      },
      "logging": {
        "directory": "",
        "min_duration": 0.1
      }
    }
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: taginfo
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: taginfo
  template:
    metadata:
      labels:
        app: taginfo
    spec:
      containers:
        - name: taginfo
          image: osm-planet-in-da-house-taginfo:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 4567
          volumeMounts:
            - name: taginfo-data
              mountPath: /usr/src/app/data
            - name: taginfo-config
              mountPath: /usr/src/app/taginfo-config.json
              subPath: taginfo-config.json
      volumes:
        - name: taginfo-data
          hostPath:
            path: /everything/src/github.com/yuiseki/osm-planet-in-da-house/data/taginfo
            type: Directory
        - name: taginfo-config
          configMap:
            name: taginfo-config
            items:
              - key: taginfo-config.json
                path: taginfo-config.json
---
apiVersion: v1
kind: Service
metadata:
  name: taginfo
spec:
  selector:
    app: taginfo
  ports:
    - name: http
      port: 4567
      targetPort: 4567
      nodePort: 30114
  type: NodePort
